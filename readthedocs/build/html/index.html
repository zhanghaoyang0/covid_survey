

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>A COVID-19 survey in China &mdash; covid_survey v0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="#" class="icon icon-home"> covid_survey
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">A COVID-19 survey in China</a></li>
<li><a class="reference internal" href="#questionnaire-data">Questionnaire Data</a></li>
<li><a class="reference internal" href="#analysis-preparation">Analysis: preparation</a></li>
<li><a class="reference internal" href="#analysis-data-cleaning-and-description">Analysis: data cleaning and description</a></li>
<li><a class="reference internal" href="#analysis-regression">Analysis: regression</a></li>
<li><a class="reference internal" href="#analysis-plot">Analysis: plot</a></li>
<li><a class="reference internal" href="#comments-and-feedbacks">Comments and feedbacks</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">covid_survey</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>A COVID-19 survey in China</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="a-covid-19-survey-in-china">
<h1>A COVID-19 survey in China<a class="headerlink" href="#a-covid-19-survey-in-china" title="Permalink to this heading">¶</a></h1>
<p>In Dec 2022, the COVID-19 restriction was end.</p>
<p>We conducted a 3-week on-line survey to measure the characteristics to measure the characteristics of COVID-19 patients in China.</p>
<p>We investigated:</p>
<p>Symptom spectrum of COVID-19:</p>
<a class="reference internal image-reference" href="_images/fig1.png"><img alt="_images/fig1.png" class="align-center" src="_images/fig1.png" style="width: 600px;" /></a>
<p>Cluster of COVID-19 symptoms:</p>
<a class="reference internal image-reference" href="_images/fig2.png"><img alt="_images/fig2.png" class="align-center" src="_images/fig2.png" style="width: 600px;" /></a>
<p>Regional distribution of COVID-19 syndromes:</p>
<a class="reference internal image-reference" href="_images/fig3.png"><img alt="_images/fig3.png" class="align-center" src="_images/fig3.png" style="width: 600px;" /></a>
<p>Regional distribution of COVID-19 symptoms:</p>
<a class="reference internal image-reference" href="_images/fig4.png"><img alt="_images/fig4.png" class="align-center" src="_images/fig4.png" style="width: 600px;" /></a>
<p>And, measure the association between COVID-19 symptoms and population characteristics, vaccination, and medication.</p>
</div>
<div class="section" id="questionnaire-data">
<h1>Questionnaire Data<a class="headerlink" href="#questionnaire-data" title="Permalink to this heading">¶</a></h1>
<p>The questionnaire was open for around 3 weeks, from 22th Dec 2022 to 17th Jan 2023.</p>
<p>552 questionnaires were collected.</p>
<p>The data is in Chinese. Please see our code about how to clean this data.</p>
<p>You can download the data at <a class="reference external" href="https://github.com/zhanghaoyang0/covid_survey/raw/master/data/covid_survey.xlsx">here</a>.</p>
</div>
<div class="section" id="analysis-preparation">
<h1>Analysis: preparation<a class="headerlink" href="#analysis-preparation" title="Permalink to this heading">¶</a></h1>
<p>We used R 4.0.3 for analysis.</p>
<p>Load packages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">libs</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;openxlsx&#39;</span><span class="p">,</span> <span class="s1">&#39;stringr&#39;</span><span class="p">,</span> <span class="s1">&#39;dplyr&#39;</span><span class="p">,</span> <span class="s1">&#39;stringi&#39;</span><span class="p">,</span> <span class="s1">&#39;R.utils&#39;</span><span class="p">,</span> <span class="s1">&#39;ggplot2&#39;</span><span class="p">,</span> <span class="s1">&#39;ggpubr&#39;</span><span class="p">,</span> <span class="s1">&#39;ggsci&#39;</span><span class="p">,</span> <span class="s1">&#39;mapchina&#39;</span><span class="p">,</span> <span class="s1">&#39;sf&#39;</span><span class="p">,</span> <span class="s1">&#39;data.table&#39;</span><span class="p">,</span><span class="s1">&#39;NbClust&#39;</span><span class="p">,</span> <span class="s1">&#39;igraph&#39;</span><span class="p">,</span> <span class="s1">&#39;factoextra&#39;</span><span class="p">)</span>
<span class="n">lapply</span><span class="p">(</span><span class="n">libs</span><span class="p">,</span> <span class="n">require</span><span class="p">,</span> <span class="n">character</span><span class="o">.</span><span class="n">only</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">options</span><span class="p">(</span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="n">F</span><span class="p">)</span>
<span class="n">sf</span><span class="p">::</span><span class="n">sf_use_s2</span><span class="p">(</span><span class="n">FALSE</span><span class="p">)</span>
</pre></div>
</div>
<p>Define functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># calculate proportion of a given var for all, male, female participants
# e.g,
# temp = data.frame(sex=c(&#39;Male&#39;, &#39;Female&#39;), var=c(1, 0))
# get_prop(temp, &#39;var&#39;)
get_prop = function(df, var){
   for (sex1 in c(&#39;Male|Female&#39;, &#39;Male&#39;, &#39;Female&#39;)){
      df1 = df%&gt;%filter(grepl(sex1, sex))
      tab = table(df1[,var])
      frq = data.frame(var=names(tab), n=as.numeric(tab))
      frq = frq%&gt;%mutate(n=paste0(n,&#39;(&#39;, sprintf(&#39;%.2f&#39;, n*100/sum(tab)),&#39;%)&#39;))
      print(paste0(&#39;distribution of &#39;, ifelse(sex1==&#39;Male|Female&#39;, &#39;all&#39;, tolower(sex1)), &#39; participants in &#39;, var, &#39;:&#39;))
      print(frq)
   }
}
# convert character vector to numeric
# e.g, df = df%&gt;%mutate_if(is_numeric,as.numeric)
is_numeric &lt;- function(x) {
   !any(is.na(suppressWarnings(as.numeric(na.omit(x))))) &amp; is.character(x)
}
</pre></div>
</div>
</div>
<div class="section" id="analysis-data-cleaning-and-description">
<h1>Analysis: data cleaning and description<a class="headerlink" href="#analysis-data-cleaning-and-description" title="Permalink to this heading">¶</a></h1>
<p>We conducted data cleaning by translating Chinese to English, combining groups with small samples, etc.
Description was also performed.</p>
<p>You may clone our repository, which contains our data, results, and plots:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">zhanghaoyang0</span><span class="o">/</span><span class="n">covid_survey</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">covid_survey</span>
</pre></div>
</div>
<p>Or you can just download our data and performed the below analysis. If you do so, pleasue change the path in the code.</p>
<p>Load data and clean:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## questionaire data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">xlsx</span><span class="p">(</span><span class="s1">&#39;data/covid_survey_20230112.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># questionaire</span>
<span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">=</span> <span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;/|，|？|“|”&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="c1"># remove Chinese punctuations</span>
<span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">=</span> <span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">fixed</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">=</span> <span class="n">str_replace</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="s1">&#39;在感染后是否有出现以下[\U4E00-\U9FFF\U3000-\U303F]+症状:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">=</span> <span class="n">str_replace</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="s1">&#39;[（][\U4E00-\U9FFF\U3000-\U303F|1-9]+[）]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c1">## drop unused items and atypical symptons</span>
<span class="n">drop_cols</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;提交时间&#39;</span><span class="p">,</span> <span class="s1">&#39;答题时间&#39;</span><span class="p">,</span> <span class="s1">&#39;喉咙有刀割感&#39;</span><span class="p">,</span> <span class="s1">&#39;吞咽时疼痛&#39;</span><span class="p">,</span> <span class="s1">&#39;喉咙嘶哑&#39;</span><span class="p">,</span> <span class="s1">&#39;喉咙干痒&#39;</span><span class="p">,</span> <span class="s1">&#39;性欲减退&#39;</span><span class="p">,</span> <span class="s1">&#39;生理期异常&#39;</span><span class="p">,</span> <span class="s1">&#39;肾脏部位疼痛&#39;</span><span class="p">,</span> <span class="s1">&#39;流泪&#39;</span><span class="p">,</span> <span class="s1">&#39;打喷嚏&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[,</span><span class="n">drop_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">NULL</span> <span class="c1"># drop atypical symptons</span>
<span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1">## replace chinese with english</span>
<span class="n">dict1</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">xlsx</span><span class="p">(</span><span class="s1">&#39;data/covid_survey_20230112.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">dict2</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">xlsx</span><span class="p">(</span><span class="s1">&#39;data/covid_survey_20230112.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">dict</span> <span class="o">=</span> <span class="n">rbind</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">[,</span><span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;chinese items to english:&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="nb">dict</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">:</span><span class="n">nrow</span><span class="p">(</span><span class="nb">dict</span><span class="p">)){</span>
   <span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="n">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">==</span><span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Age and sex:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>df = df%&gt;%mutate(age=gsub(&#39;岁&#39;, &#39;&#39;, age))%&gt;%
   mutate(age=ifelse(age%in%c(&#39;41-50&#39;, &#39;51-60&#39;, &#39;61-70&#39;), &#39;&gt;40&#39;, age))%&gt;%
   mutate(age=ifelse(age%in%c(&#39;12-18&#39;,  &#39;18-24&#39;, &#39;6-12&#39;, &#39;3-6&#39;), &#39;&lt;24&#39;, age))%&gt;%
   mutate(age=factor(age, levels=c(&#39;&lt;24&#39;, &#39;24-30&#39;, &#39;31-40&#39;, &#39;&gt;40&#39;)))
df = df%&gt;%mutate(sex=factor(ifelse(sex==&#39;女&#39;,&#39;Female&#39;, &#39;Male&#39;), levels=c(&#39;Female&#39;, &#39;Male&#39;)))
table(df$sex)
get_prop(df, &#39;age&#39;)
</pre></div>
</div>
<p>Disease duration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># assume interval is left closed and right open, modify to reduce confusing
df$infect_duration[df$infect_duration==&#39;3～5天&#39;] = &#39;3~4天&#39;
df$infect_duration[df$infect_duration==&#39;5~7天&#39;] = &#39;5~6天&#39;
df$infect_duration[df$infect_duration==&#39;7~10天&#39;] = &#39;7~9天&#39;

df = df%&gt;%mutate(infect_duration=ifelse(infect_duration%in%c(&#39;7~9天&#39;, &#39;10天以上&#39;), &#39;&gt;7 day&#39;, infect_duration))%&gt;%
   mutate(infect_duration=ifelse(infect_duration%in%c(&#39;&#39;, &#39;小于3天&#39;), &#39;&lt;3 day&#39;, infect_duration))%&gt;%
   mutate(infect_duration=gsub(&#39;天&#39;, &#39; day&#39;, infect_duration))%&gt;%
   mutate(infect_duration=gsub(&#39;~&#39;, &#39;-&#39;, infect_duration))%&gt;%
   mutate(infect_duration=factor(infect_duration, levels=c(&#39;&lt;3 day&#39;, &#39;3-4 day&#39;, &#39;5-6 day&#39;, &#39;&gt;7 day&#39;)))
get_prop(df, &#39;infect_duration&#39;)
# trim fever_duration
df$fever_duration = sapply(df$fever_duration, function(x){strsplit(x, &#39;[(]&#39;)[[1]][1]})
df = df%&gt;%mutate(fever_duration=ifelse(is.na(fever_duration), &#39;no reply&#39;, fever_duration))%&gt;%
   mutate(fever_duration=gsub(&#39;天&#39;, &#39; day&#39;, fever_duration))%&gt;%
   mutate(fever_duration=ifelse(fever_duration%in%c(&#39;1 day&#39;, &#39;&lt;1 day&#39;), &#39;≤1 day&#39;, fever_duration))%&gt;%
   mutate(fever_duration=factor(fever_duration, levels=c(&#39;no reply&#39;, &#39;≤1 day&#39;, &#39;2 day&#39;, &#39;3 day&#39;, &#39;&gt;3 day&#39;)))
get_prop(df, &#39;fever_duration&#39;)
</pre></div>
</div>
<p>Infect route:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">%&gt;%</span><span class="n">mutate</span><span class="p">(</span>
   <span class="n">infectway_entertainment</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s1">&#39;消费场所&#39;</span><span class="p">,</span> <span class="n">infect_way</span><span class="p">))),</span>
   <span class="n">infectway_work</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s1">&#39;工作场所&#39;</span><span class="p">,</span> <span class="n">infect_way</span><span class="p">))),</span>
   <span class="n">infectway_family</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s1">&#39;在家被家人传染&#39;</span><span class="p">,</span> <span class="n">infect_way</span><span class="p">))),</span>
   <span class="n">infectway_traffic</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s1">&#39;公共交通&#39;</span><span class="p">,</span> <span class="n">infect_way</span><span class="p">))),</span>
   <span class="n">infectway_hosp</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="k">as</span><span class="o">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s1">&#39;医疗场所&#39;</span><span class="p">,</span> <span class="n">infect_way</span><span class="p">))))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;infectway_entertainment&#39;</span><span class="p">,</span> <span class="s1">&#39;infectway_work&#39;</span><span class="p">,</span> <span class="s1">&#39;infectway_family&#39;</span><span class="p">,</span> <span class="s1">&#39;infectway_traffic&#39;</span><span class="p">,</span> <span class="s1">&#39;infectway_hosp&#39;</span><span class="p">)){</span>
   <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
   <span class="n">get_prop</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vaccination:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>df[df$how_long_lastvac==&#39;&#39;, &#39;n_vac&#39;] = &#39;0&#39; # if a person report n_vac but not how_long_lastvac, treat n_vac as NA
df = df%&gt;%mutate(n_vac=ifelse(n_vac%in%c(3, 4), &#39;≥3&#39;, n_vac))%&gt;%
   mutate(n_vac=factor(n_vac, levels=c(&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;≥3&#39;)))

df = df%&gt;%mutate(how_long_lastvac=ifelse(how_long_lastvac==&#39;&#39;, &#39;no_vac&#39;, how_long_lastvac))%&gt;%
   mutate(how_long_lastvac=gsub(&#39;个月&#39;, &#39; month&#39;, how_long_lastvac))%&gt;%
   mutate(how_long_lastvac=ifelse(how_long_lastvac%in%c(&#39;&lt;3 month&#39;, &#39;3-6 month&#39;), &#39;&lt;6 month&#39;, how_long_lastvac))%&gt;%
   mutate(how_long_lastvac=factor(how_long_lastvac, levels=c(&#39;no_vac&#39;, &#39;&lt;6 month&#39;, &#39;6-12 month&#39;, &#39;&gt;12 month&#39;)))

get_prop(df, &#39;n_vac&#39;)
get_prop(df, &#39;how_long_lastvac&#39;)
</pre></div>
</div>
<p>Medication:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># the &#39;drug_use&#39; have been grouped to four groups, by hand</span>
<span class="n">drugs</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;ibuprofen_use&#39;</span><span class="p">,</span> <span class="s1">&#39;acetaminophen_use&#39;</span><span class="p">,</span> <span class="s1">&#39;chnmed_usd&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[,</span> <span class="n">drugs</span><span class="p">][</span><span class="ow">is</span><span class="o">.</span><span class="n">na</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span> <span class="n">drugs</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">drug</span> <span class="ow">in</span> <span class="n">drugs</span><span class="p">){</span>
   <span class="k">print</span><span class="p">(</span><span class="n">drug</span><span class="p">)</span>
   <span class="n">get_prop</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">drug</span><span class="p">)</span>
   <span class="n">df</span><span class="p">[,</span><span class="n">drug</span><span class="p">]</span> <span class="o">=</span> <span class="k">as</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span><span class="n">drug</span><span class="p">])</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Calculate syndrome score with symptom score, normalize to 0-1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>## calculate syndrome score with symptom score, normalize to 0-1
syndromes = unique(dict2$syndrome)
symptoms = list()
for (i in syndromes){
   symptoms[[i]] = dict2%&gt;%filter(syndrome==i)%&gt;%pull(item_eng)
}
print(symptoms)
print(sum(is.na(df[,unlist(symptoms)]))) # number of NA
for (syndrome in syndromes){
   score = rowSums(df[,symptoms[[syndrome]]])/length(symptoms[[syndrome]])/3 # normalize to 0-1
   df[,paste0(syndrome, &#39;_score&#39;)] = score
}
</pre></div>
</div>
<p>Region:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>## region
df$region = gsub(&#39;维吾尔|壮族&#39;, &#39;&#39;, df$region)
regions = c()
for (i in 1:nrow(df)){
   item = df[i, &#39;region&#39;]
   item1 = strsplit(item, &#39;自治区|自治州|特别行政区|省|市&#39;)[[1]][1]
   regions = c(regions, item1)
}
df$region = regions
# replace chn with pinyin
data(china)
china = china%&gt;%mutate(region=gsub(&#39;省|市|回族|壮族|维吾尔|特别行政区|自治区&#39;, &#39;&#39;, Name_Province))
china = china%&gt;%group_by(region)%&gt;%dplyr::summarise(geometry=st_union(geometry))
replace = data.frame(region=china$region,
region1 = c(&#39;Shanghai&#39;, &#39;Yunnan&#39;, &#39;Neimenggu&#39;, &#39;Beijing&#39;, &#39;Taiwan&#39;, &#39;Jilin&#39;, &#39;Sichuan&#39;, &#39;Tianji&#39;,
&#39;Ningxia&#39;, &#39;Anhui&#39;, &#39;Shandong&#39;, &#39;Shānxi&#39;, &#39;Guangdong&#39;, &#39;Guangxi&#39;, &#39;Xinjiang&#39;, &#39;Jiangsu&#39;, &#39;Jiangxi&#39;, &#39;Hebei&#39;,
&#39;Henan&#39;, &#39;Zhejiang&#39;, &#39;Hainan&#39;, &#39;Hubei&#39;, &#39;Hunan&#39;, &#39;Macau&#39;, &#39;Gansu&#39;, &#39;Fujian&#39;, &#39;Tibet&#39;, &#39;Guizhou&#39;, &#39;Liaoning&#39;,
&#39;Chongqing&#39;, &#39;Shǎnxi&#39;, &#39;Qinghai&#39;, &#39;Hong Kong&#39;, &#39;Heilongjiang&#39;))
china = china%&gt;%merge(replace, &#39;region&#39;)%&gt;%select(-region)%&gt;%rename(region=region1)
df = df%&gt;%merge(replace, &#39;region&#39;)%&gt;%select(-region)%&gt;%rename(region=region1)
print(table(df$region))
# sample size for each region
tab = table(df$region)
tab = data.frame(cbind(names(tab), tab))
pop_tab = tab%&gt;%rename(n=tab, region=V1)%&gt;%mutate(n=as.numeric(n))%&gt;%arrange(n)
print(pop_tab)
</pre></div>
</div>
</div>
<div class="section" id="analysis-regression">
<h1>Analysis: regression<a class="headerlink" href="#analysis-regression" title="Permalink to this heading">¶</a></h1>
<p>We used regression to measure the association between symptoms and population characteris, vaccination, and medication.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># we use linear regression to test if syndrome score varired in different population
# we use logistic regression to test if symptom varired in different population
# in each regression, we add age and sex as covariate
covars = c(&#39;age&#39;, &#39;sex&#39;)
test_vars = c(&#39;agesex&#39;, &#39;how_long_lastvac&#39;, &#39;n_vac&#39;,
   &#39;infectway_work&#39;, &#39;infectway_family&#39;, &#39;infectway_traffic&#39;, &#39;infectway_hosp&#39;,
   &#39;ibuprofen_use&#39;, &#39;acetaminophen_use&#39;, &#39;chnmed_usd&#39;, &#39;lianhua_use&#39;) # the first mean we only include age and sex in reg
outcomes = c(paste0(c(&#39;Respiratory&#39;, &#39;Neurological&#39;, &#39;Digestive&#39;, &#39;Other&#39;), &#39;_score&#39;), unlist(symptoms))
out = c()
for (test_var in test_vars){
   if (test_var==&#39;agesex&#39;){formula = formula(&#39;y~age+sex&#39;)}else{
      formula = formula(paste0(&#39;y~age+sex+&#39;, test_var))}
   # when var is how_long_lastvac, remove samples without vac
   if (test_var==&#39;how_long_lastvac&#39;){
      df1 = droplevels(df%&gt;%filter(how_long_lastvac!=&#39;no_vac&#39;)) # drop level
   } else {df1 = df}
   for (outcome in outcomes){
      print(outcome)
      # regression
      df1$y = df1[,outcome]
      link = &#39;gaussian&#39; # for linear reg
      if (!grepl(&#39;_score&#39;, outcome)) {
            df1$y = ifelse(df1$y==0, 0, 1) # binary outcome, logistic reg
            link = &#39;binomial&#39; # for logistic reg
      }
      reg = glm(formula, df1, family=link)
      coef = data.frame(summary(reg)$coefficients)%&gt;%tibble::rownames_to_column(&#39;var&#39;)
      coef = coef[2:nrow(coef), c(1, 2, 3, 5)]
      names(coef) = c(&#39;var&#39;, &#39;beta&#39;, &#39;se&#39;, &#39;p&#39;)
      # calculate distribution in sub population, n(%) or mean±sd
      reg_vars = strsplit(as.character(formula)[3], &#39; + &#39;, fixed=T)[[1]]
      if (test_var!=&#39;agesex&#39;){reg_vars = reg_vars[!reg_vars%in%c(&#39;age&#39;, &#39;sex&#39;)]} # we dont show coef of age and sex when testing other var
      for (reg_var in reg_vars){
            for (group in levels(df1[,reg_var])){
               temp = df1%&gt;%filter(df1[,reg_var]==group)%&gt;%pull(y)
               coef1 = coef[coef$var==paste0(reg_var, group), c(&#39;beta&#39;, &#39;se&#39;, &#39;p&#39;)]
               if (nrow(coef1)== 0){coef1 = c(&#39;NA&#39;, &#39;NA&#39;, &#39;NA&#39;)}
               if (group==levels(df1[,reg_var])[1]) {coef1 = c(&#39;Ref.&#39;, &#39;NA&#39;, &#39;NA&#39;)}
               d1 = d2 = d3 = NA
               if (!grepl(&#39;_score&#39;, outcome)){
                  d1 = paste0(sum(temp==1), &#39; (&#39;, round(sum(temp==1)/length(temp)*100,2), &#39;%)&#39;)
                  d2 = paste0(sum(temp==0), &#39; (&#39;, round(sum(temp==0)/length(temp)*100,2), &#39;%)&#39;)
               } else {d3 = paste0(sprintf(&#39;%.2f&#39;,mean(temp)), &#39;±&#39;, sprintf(&#39;%.2f&#39;,sd(temp)))}
               # formal name
               if (grepl(&#39;score&#39;, outcome)){outcome1 = gsub(&#39;_&#39;, &#39; &#39;, outcome)}else{
                  outcome1 = dict2%&gt;%filter(item_eng==outcome)%&gt;%pull(item_eng1)
               }
               out = c(out, outcome1, test_var, reg_var, group, d1, d2, d3, unlist(coef1))
            }
      }
   }
}
res = data.frame(matrix(out, ncol=10, byrow=T))
names(res) = c(&#39;outcome&#39;,&#39;test_var&#39;, &#39;reg_var&#39;, &#39;level&#39;, &#39;ncase&#39;, &#39;nctrl&#39;, &#39;mean&#39;, &#39;beta&#39;, &#39;se&#39;, &#39;p&#39;)
res1 = res%&gt;%filter(p&lt;0.05)
write.csv(res1, &#39;./result/reg.csv&#39;, row.names=F, quote=F)
# extract significant result
res1 = data.frame()
for (test_var1 in test_vars){
   for (outcome1 in unique(res$outcome)){
      sub = res%&gt;%filter(test_var==test_var1&amp;outcome==outcome1)
      if (!any(as.numeric(sub%&gt;%filter(p!=&#39;NA&#39;)%&gt;%pull(p))&lt;0.05)){next}
      res1 = rbind(res1, sub)
   }
}
</pre></div>
</div>
</div>
<div class="section" id="analysis-plot">
<h1>Analysis: plot<a class="headerlink" href="#analysis-plot" title="Permalink to this heading">¶</a></h1>
<p>Bar plot for servere of sympytoms:</p>
<a class="reference internal image-reference" href="_images/fig1.png"><img alt="_images/fig1.png" class="align-center" src="_images/fig1.png" style="width: 600px;" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>map = data.frame(score=c(0:3), score1=c(&#39;Absent&#39;, &#39;Mild&#39;, &#39;Moderate&#39;, &#39;Severe&#39;))
out = c()
for (i in unlist(symptoms)){
   for (j in c(0:3)){
      prop = sum(df[,i]==j)/nrow(df)
      out = c(out, i, j, prop)
   }
}
df_p = data.frame(matrix(out, ncol=3, byrow=T))
df_p = df_p%&gt;%mutate_if(is_numeric,as.numeric)%&gt;%rename(sympton=X1, score=X2, prop=X3)
df_p = df_p%&gt;%merge(map, &#39;score&#39;)%&gt;%mutate(score1=factor(score1, levels=c(&#39;Severe&#39;, &#39;Moderate&#39;, &#39;Mild&#39;, &#39;Absent&#39;)))
df_p%&gt;%merge(dict2, by.x=&#39;sympton&#39;, by.y=&#39;item_eng&#39;)%&gt;%select(syndrome, sympton, score1, prop) # add syndrome
plots = list()
for (syndrome in syndromes){
   df_p1 = df_p%&gt;%filter(sympton%in%symptoms[[syndrome]])
   df_p1 = df_p1%&gt;%mutate(sympton=gsub(paste0(syndrome, &#39;_&#39;), &#39;&#39;, sympton))
   xlevels = df_p1%&gt;%filter(score1==&#39;Absent&#39;)%&gt;%arrange(prop)%&gt;%pull(sympton)
   df_p1$sympton = factor(df_p1$sympton, levels=xlevels)
   df_p1 = df_p1%&gt;%rename(item_eng=sympton)%&gt;%merge(dict2, &#39;item_eng&#39;)%&gt;%rename(sympton=item_eng1) # repalce symptoms with their formal names
   p = ggplot(df_p1, aes(x = sympton, weight = prop, fill = score1))+
      geom_bar( position = &quot;stack&quot;) +
      xlab(&#39;&#39;) + ylab(&#39;&#39;) + labs(fill = &#39;Severity&#39;) +
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, color=&quot;black&quot;),
            axis.text.y = element_text(color=&quot;black&quot;), legend.position=&quot;none&quot;) +
      ggtitle(syndrome) +
      theme(plot.title = element_text(size = 15, face = &quot;bold&quot;, hjust = 0.5)) +
      coord_flip() +
      scale_fill_nejm()
   plots[[syndrome]] = p
}
# multiple plot
p1 &lt;- ggarrange(plots[[1]], plots[[2]], plots[[3]], plots[[4]],
   ncol=2, nrow=2, common.legend=T, legend=&quot;bottom&quot;,
   hjust=0.1, vjust=0.1)
file_out = &#39;./plot/bar.png&#39;
png(file_out, height=1000, width=1000, res=160)
print(p1)
dev.off()
</pre></div>
</div>
<p>Dendrogram for sympytoms clustering:</p>
<a class="reference internal image-reference" href="_images/fig2.png"><img alt="_images/fig2.png" class="align-center" src="_images/fig2.png" style="width: 600px;" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path_out</span> <span class="o">=</span> <span class="s1">&#39;./plot/hclust/&#39;</span>
<span class="n">df_p</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span> <span class="n">unlist</span><span class="p">(</span><span class="n">symptoms</span><span class="p">)])</span>
<span class="c1"># repalce symptoms with their formal names</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">dict2</span><span class="p">)){</span>
   <span class="n">row</span><span class="o">.</span><span class="n">names</span><span class="p">(</span><span class="n">df_p</span><span class="p">)[</span><span class="n">row</span><span class="o">.</span><span class="n">names</span><span class="p">(</span><span class="n">df_p</span><span class="p">)</span><span class="o">==</span><span class="n">dict2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;item_eng&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dict2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;item_eng1&#39;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="n">df_p</span><span class="p">)</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">hclust</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;average&quot;</span><span class="p">)</span>
<span class="n">png</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">path_out</span><span class="p">,</span> <span class="s1">&#39;hclust.png&#39;</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">fviz_dend</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rect</span> <span class="o">=</span><span class="n">F</span><span class="p">,</span> <span class="n">rect_fill</span> <span class="o">=</span> <span class="n">T</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;aaas&#39;</span><span class="p">,</span> <span class="n">cex</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
   <span class="nb">type</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;rectangle&quot;</span><span class="p">),</span> <span class="c1"># type = c(&quot;rectangle&quot;, &quot;circular&quot;, &quot;phylogenic&quot;)</span>
   <span class="n">main</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Dendrogram height&quot;</span><span class="p">,</span> <span class="n">horiz</span> <span class="o">=</span> <span class="n">T</span><span class="p">)</span>  <span class="c1"># ggsci color</span>
<span class="n">dev</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
<span class="c1"># multiple plot</span>
<span class="n">p1</span> <span class="o">&lt;-</span> <span class="n">ggarrange</span><span class="p">(</span><span class="n">plots</span><span class="p">[[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">plots</span><span class="p">[[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">plots</span><span class="p">[[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">plots</span><span class="p">[[</span><span class="mi">4</span><span class="p">]],</span>
   <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">legend</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
   <span class="n">hjust</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">file_out</span> <span class="o">=</span> <span class="s1">&#39;./plot/bar.png&#39;</span>
<span class="n">png</span><span class="p">(</span><span class="n">file_out</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="n">dev</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
</pre></div>
</div>
<p>Heatmap for regional distribution of symptoms:</p>
<a class="reference internal image-reference" href="_images/fig3.png"><img alt="_images/fig3.png" class="align-center" src="_images/fig3.png" style="width: 600px;" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>res = data.frame()
provs =  names(rev(sort(table(df$region)))) # sort by n
for (prov in provs){
   sub = df%&gt;%filter(region==prov)
   temp = colMeans(sub[,unlist(symptoms)])/3
   add = data.frame(region=prov, symptom=names(temp), score=temp, n=nrow(sub))
   res = rbind(res, add)
}
# replace symptom names with their formal name
res = res%&gt;%merge(dict2%&gt;%select(item_eng, item_eng1), by.x=&#39;symptom&#39;, by.y=&#39;item_eng&#39;)%&gt;%select(-symptom)%&gt;%rename(symptom=item_eng1)
# filter region with less than 10 samples
res = res%&gt;%filter(n&gt;=10)
p = res%&gt;%
   ggplot(aes(region, symptom, fill=score)) +
   geom_tile() +
   labs(x = NULL, y = NULL, fill = &quot;Score&quot;, title=&quot;&quot;, subtitle=&quot;&quot;) +
   scale_fill_gradient2(limits=c(0,1)) +
   theme_classic() +
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, color=&quot;black&quot;),
      axis.text.y = element_text(color=&quot;black&quot;),
      legend.title = element_text(size=12)) +
   scale_fill_distiller(palette = &quot;Spectral&quot;)
file_out = &#39;./plot/heatmap.png&#39;
png(file_out, height=1000, width=800, res=150)
print(p)
dev.off()
</pre></div>
</div>
<p>Map for regional distribution of syndromes:</p>
<a class="reference internal image-reference" href="_images/fig4.png"><img alt="_images/fig4.png" class="align-center" src="_images/fig4.png" style="width: 600px;" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mean score</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
<span class="n">plots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">group</span> <span class="ow">in</span> <span class="n">syndromes</span><span class="p">){</span>
   <span class="k">print</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
   <span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[,</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="n">paste0</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="s1">&#39;_score&#39;</span><span class="p">))]</span>
   <span class="n">names</span><span class="p">(</span><span class="n">temp</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;score&#39;</span>
   <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">%&gt;%</span><span class="n">group_by</span><span class="p">(</span><span class="n">region</span><span class="p">)</span><span class="o">%&gt;%</span><span class="n">dplyr</span><span class="p">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">score</span><span class="p">))</span>
   <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">%&gt;%</span><span class="n">merge</span><span class="p">(</span><span class="n">pop_tab</span><span class="p">,</span> <span class="s1">&#39;region&#39;</span><span class="p">)</span><span class="o">%&gt;%</span><span class="nb">filter</span><span class="p">(</span><span class="n">n</span><span class="o">&gt;=</span><span class="mi">10</span><span class="p">)</span><span class="o">%&gt;%</span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">score</span><span class="p">))</span>
   <span class="n">sub</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">%&gt;%</span><span class="n">mutate</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>
   <span class="n">res</span> <span class="o">=</span> <span class="n">rbind</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
   <span class="n">map1</span> <span class="o">=</span> <span class="n">china</span><span class="o">%&gt;%</span><span class="n">merge</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="nb">all</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">T</span><span class="p">)</span><span class="o">%&gt;%</span><span class="n">mutate</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">ifelse</span><span class="p">(</span><span class="ow">is</span><span class="o">.</span><span class="n">na</span><span class="p">(</span><span class="n">score</span><span class="p">),</span> <span class="n">NA</span><span class="p">,</span> <span class="n">region</span><span class="p">))</span> <span class="c1"># add to map</span>
   <span class="n">p</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">map1</span><span class="p">)</span> <span class="o">+</span>
      <span class="n">geom_sf</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">score</span><span class="p">))</span> <span class="o">+</span>
      <span class="n">geom_sf_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">region</span><span class="p">),</span> <span class="n">colour</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span> <span class="o">+</span>
      <span class="n">scale_fill_distiller</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s2">&quot;Spectral&quot;</span><span class="p">)</span> <span class="o">+</span>
      <span class="n">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s1">&#39;Score&#39;</span><span class="p">)</span> <span class="o">+</span>
      <span class="n">ggtitle</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">+</span>
      <span class="n">theme</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span> <span class="n">face</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=-</span><span class="mi">9</span><span class="p">),</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span> <span class="n">panel</span><span class="o">.</span><span class="n">border</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span> <span class="n">axis</span><span class="o">.</span><span class="n">ticks</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span> <span class="n">axis</span><span class="o">.</span><span class="n">ticks</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
            <span class="n">legend</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">height</span><span class="o">=</span> <span class="n">unit</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">),</span> <span class="n">legend</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">width</span><span class="o">=</span> <span class="n">unit</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">),</span>
            <span class="n">legend</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="n">legend</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">major</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span> <span class="n">panel</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">minor</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">())</span> <span class="o">+</span>
      <span class="n">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span>
      <span class="n">coord_sf</span><span class="p">(</span><span class="n">xlim</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="mi">135</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">54</span><span class="p">),</span> <span class="n">expand</span> <span class="o">=</span> <span class="n">T</span><span class="p">)</span>

   <span class="n">plots</span><span class="p">[[</span><span class="n">group</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span>
<span class="p">}</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">ggarrange</span><span class="p">(</span><span class="n">plots</span><span class="p">[[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">plots</span><span class="p">[[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">plots</span><span class="p">[[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">plots</span><span class="p">[[</span><span class="mi">4</span><span class="p">]],</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
   <span class="n">common</span><span class="o">.</span><span class="n">legend</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<span class="n">file_out</span> <span class="o">=</span> <span class="s1">&#39;./plot/map.png&#39;</span>
<span class="n">png</span><span class="p">(</span><span class="n">file_out</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1300</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1700</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
<span class="n">dev</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
<span class="n">res</span> <span class="c1"># average score</span>
</pre></div>
</div>
</div>
<div class="section" id="comments-and-feedbacks">
<h1>Comments and feedbacks<a class="headerlink" href="#comments-and-feedbacks" title="Permalink to this heading">¶</a></h1>
<p>Feel free to contact me via <a class="reference external" href="mailto:zhanghaoyang0&#37;&#52;&#48;hotmail&#46;com">zhanghaoyang0<span>&#64;</span>hotmail<span>&#46;</span>com</a></p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, zhanghaoyang0.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'v0',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/documentation_options.js"></script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>